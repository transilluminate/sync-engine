cargo run --example basic_usage
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
     Running `target/debug/examples/basic_usage`

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           sync-engine: Basic Usage Example                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ Configuring sync-engine...
2025-12-30T07:50:43.313898Z  INFO Creating expandable cuckoo filter manager node_id=sync-engine-l3 initial_capacity=100000
   State: Created

ğŸš€ Starting engine (connecting to backends)...
2025-12-30T07:50:43.317723Z  INFO start: Starting sync engine with trust-verified startup...
2025-12-30T07:50:43.317982Z  INFO start: Initializing write-ahead log path=./sync_engine_wal.db max_items=1000000 max_bytes=104857600
2025-12-30T07:50:43.325468Z  INFO start: Write-ahead log initialized path=./sync_engine_wal.db
2025-12-30T07:50:43.327888Z  INFO start: Connecting to SQL (L3 - ground truth)... url=mysql://test:test@localhost:3306/test
2025-12-30T07:50:43.394961Z  INFO start: SQL (L3) connected with merkle store (ground truth) has_sql=true
2025-12-30T07:50:43.396453Z  INFO start: SQL merkle root (ground truth) root=62452fe3ad5a716b33a70105bb7387265e2997ba4f93fb2b618cfb8c646f5530 has_sql=true
2025-12-30T07:50:43.396889Z  INFO start: No L3 CF snapshot found - filter will be built on warmup has_sql=true
2025-12-30T07:50:43.396964Z  INFO start: Connecting to Redis (L2 - cache)... url=redis://localhost:6379 has_sql=true
2025-12-30T07:50:43.400069Z  INFO start: Redis (L2) connected with merkle shadow tree has_sql=true has_redis=true
2025-12-30T07:50:43.405907Z  INFO start: Redis merkle root mismatch - initiating branch diff sync sql_root=62452fe3ad5a716b33a70105bb7387265e2997ba4f93fb2b618cfb8c646f5530 redis_root=67fb6e2e6185c18d4118ebdd8863e09960db9a52caa65e302a7b65fabb7c02ae has_sql=true has_redis=true
2025-12-30T07:50:43.408323Z  INFO start: Redis sync complete via branch diff items_synced=0 has_sql=true has_redis=true
2025-12-30T07:50:43.408427Z  INFO start: Sync engine ready (trust-verified startup complete) has_sql=true has_redis=true
   âœ… Engine ready! State: Ready

ğŸ“ Creating 5 sample entries...
   â±ï¸  Timing each .await() to showcase L1 cache speed
   â””â”€ Submitted: user.alice â†’ {"name":"Alice","role":"admin"} (120.875Âµs)
   â””â”€ Submitted: user.bob â†’ {"name":"Bob","role":"user"} (79.833Âµs)
   â””â”€ Submitted: user.carol â†’ {"name":"Carol","role":"user"} (71.291Âµs)
   â””â”€ Submitted: config.app â†’ {"theme":"dark","version":"2.0"} (69.25Âµs)
   â””â”€ Submitted: stats.daily â†’ {"latency_p99":12,"requests":42000} (71.042Âµs)
   âš¡ Submit avg: 82.458Âµs (L1 memory write, non-blocking)

â³ Flushing to backends...
2025-12-30T07:50:43.457769Z  INFO Batch flush complete l2_success=5 l2_errors=0 l3_success=5 wal_fallback=0 groups=1 flush_ms=48 reason=Manual
   âœ… Flush complete!

ğŸ” Checking existence...
   â””â”€ contains_fast('user.alice'): true
   â””â”€ contains('user.alice'): true
   â””â”€ contains('user.nobody'): false

ğŸ“– Fetching entries back (with timing)...
   â±ï¸  These should hit L1 cache (microseconds!)
   â””â”€ user.alice (v1) â†’ {"name":"Alice","role":"admin"} (125.125Âµs)
   â””â”€ user.bob (v1) â†’ {"name":"Bob","role":"user"} (34.5Âµs)
   â””â”€ user.carol (v1) â†’ {"name":"Carol","role":"user"} (28.625Âµs)
   â””â”€ config.app (v1) â†’ {"theme":"dark","version":"2.0"} (26.958Âµs)
   â””â”€ stats.daily (v1) â†’ {"latency_p99":12,"requests":42000} (25.75Âµs)
   âš¡ Get avg: 48.191Âµs (L1 cache hit)

ğŸ“Š Engine Metrics:
   â”Œâ”€ L1 Cache (Memory)
   â”‚  â””â”€ Entries: 5
   â”‚  â””â”€ Size: 1445 bytes
   â”‚  â””â”€ Pressure: 0.0%
   â”œâ”€ L3 Cuckoo Filter (before verify)
   â”‚  â””â”€ Entries: 5/100000
   â”‚  â””â”€ Trust: Untrusted
   â”œâ”€ Merkle Trees
   â”‚  â””â”€ Redis (L2): 7d89930843d3e23924cd3a3cda9ce8703508a5eb62d22771e6d4a4cca4d88c95
   â”‚  â””â”€ SQL (L3):   dcc84cec0b5be24bc4dfe7341336e2afd649ab701772a2edd99a9bf41f21db7b
   â”‚  â””â”€ âš ï¸  Roots differ (expected during warmup)

ğŸ” Verifying L3 filter against SQL merkle...
2025-12-30T07:50:43.580835Z  INFO Verifying L3 filter against SQL merkle root sql_root=dcc84cec0b5be24bc4dfe7341336e2afd649ab701772a2edd99a9bf41f21db7b
2025-12-30T07:50:43.580857Z  INFO Marking cuckoo filter as trusted entries=5
   â””â”€ Verified: true â†’ Trust: Trusted

ğŸ“ Item Status:
   â””â”€ user.alice: Synced { in_l1: true, in_l2: true, in_l3: true }
   â””â”€ user.bob: Synced { in_l1: true, in_l2: true, in_l3: true }
   â””â”€ user.carol: Synced { in_l1: true, in_l2: true, in_l3: true }
   â””â”€ config.app: Synced { in_l1: true, in_l2: true, in_l3: true }
   â””â”€ stats.daily: Synced { in_l1: true, in_l2: true, in_l3: true }

ğŸ“ˆ Raw Metrics (OTEL export format):
   â”Œâ”€ Counters (cumulative)
   â”‚  â””â”€ sync_engine_bytes_written_total{tier=L1} = 156
   â”‚  â””â”€ sync_engine_bytes_written_total{tier=L2} = 156
   â”‚  â””â”€ sync_engine_bytes_written_total{tier=L3} = 156
   â”‚  â””â”€ sync_engine_items_written_total{tier=L2} = 5
   â”‚  â””â”€ sync_engine_items_written_total{tier=L3} = 5
   â”‚  â””â”€ sync_engine_merkle_operations_total{store=redis,operation=batch_update,status=success} = 1
   â”‚  â””â”€ sync_engine_operations_total{tier=L1,operation=submit,status=success} = 5
   â”‚  â””â”€ sync_engine_operations_total{tier=L2,operation=batch_write,status=success} = 1
   â”‚  â””â”€ sync_engine_operations_total{tier=L3,operation=batch_write,status=success} = 1
   â”‚  â””â”€ sync_engine_operations_total{tier=L1,operation=get,status=hit} = 5
   â”œâ”€ Gauges (current value)
   â”‚  â””â”€ sync_engine_backend_healthy{backend=mysql} = 1.00
   â”‚  â””â”€ sync_engine_backend_healthy{backend=redis} = 1.00
   â”‚  â””â”€ sync_engine_backpressure_level = 0.00
   â”‚  â””â”€ sync_engine_cuckoo_filter_entries{filter=L3} = 5.00
   â”‚  â””â”€ sync_engine_cuckoo_filter_load{filter=L3} = 0.00
   â”‚  â””â”€ sync_engine_l1_cache_bytes = 1445.00
   â”‚  â””â”€ sync_engine_l1_cache_items = 5.00
   â”‚  â””â”€ sync_engine_memory_pressure = 0.00
   â””â”€ Histograms (distributions)
   â”‚  â””â”€ sync_engine_batch_bytes{tier=L2}
   â”‚     count=1 sum=156.0000 avg=156.0000 min=156.0000 max=156.0000
   â”‚  â””â”€ sync_engine_batch_bytes{tier=L3}
   â”‚     count=1 sum=156.0000 avg=156.0000 min=156.0000 max=156.0000
   â”‚  â””â”€ sync_engine_batch_size{tier=L2}
   â”‚     count=1 sum=5.0000 avg=5.0000 min=5.0000 max=5.0000
   â”‚  â””â”€ sync_engine_batch_size{tier=L3}
   â”‚     count=1 sum=5.0000 avg=5.0000 min=5.0000 max=5.0000
   â”‚  â””â”€ sync_engine_flush_seconds
   â”‚     count=1 sum=0.0486 avg=0.0486 min=0.0486 max=0.0486
   â”‚  â””â”€ sync_engine_operation_seconds{tier=L1,operation=submit}
   â”‚     count=5 sum=0.0002 avg=0.0000 min=0.0000 max=0.0001
   â”‚  â””â”€ sync_engine_operation_seconds{tier=L2,operation=batch_write}
   â”‚     count=1 sum=0.0006 avg=0.0006 min=0.0006 max=0.0006
   â”‚  â””â”€ sync_engine_operation_seconds{tier=L3,operation=batch_write}
   â”‚     count=1 sum=0.0089 avg=0.0089 min=0.0089 max=0.0089
   â”‚  â””â”€ sync_engine_operation_seconds{tier=L1,operation=get}
   â”‚     count=5 sum=0.0001 avg=0.0000 min=0.0000 max=0.0000
   â”‚  â””â”€ sync_engine_startup_seconds{phase=wal_init}
   â”‚     count=1 sum=0.0077 avg=0.0077 min=0.0077 max=0.0077
   â”‚  â””â”€ sync_engine_startup_seconds{phase=sql_connect}
   â”‚     count=1 sum=0.0670 avg=0.0670 min=0.0670 max=0.0670
   â”‚  â””â”€ sync_engine_startup_seconds{phase=cf_restore}
   â”‚     count=1 sum=0.0004 avg=0.0004 min=0.0004 max=0.0004
   â”‚  â””â”€ sync_engine_startup_seconds{phase=redis_connect}
   â”‚     count=1 sum=0.0031 avg=0.0031 min=0.0031 max=0.0031
   â”‚  â””â”€ sync_engine_startup_seconds{phase=redis_sync}
   â”‚     count=1 sum=0.0083 avg=0.0083 min=0.0083 max=0.0083
   â”‚  â””â”€ sync_engine_startup_total_seconds
   â”‚     count=1 sum=0.0907 avg=0.0907 min=0.0907 max=0.0907

ğŸ›‘ Shutting down...
2025-12-30T07:50:43.589153Z  INFO shutdown: Initiating sync engine shutdown...
2025-12-30T07:50:43.611004Z  INFO shutdown: Filter state saved filter_id="l3" entry_count=5 bytes=131108
2025-12-30T07:50:43.611038Z  INFO shutdown: Cuckoo filter snapshot saved (L3 only) reason="shutdown" inserts_since_last=5 l3_entries=5 merkle_root=dcc84cec0b5be24bc4dfe7341336e2afd649ab701772a2edd99a9bf41f21db7b
2025-12-30T07:50:43.611076Z  INFO shutdown: Sync engine shutdown complete
   âœ… Shutdown complete! State: ShuttingDown

ğŸ§¹ Cleaning up WAL file...
   â””â”€ Removed: ./sync_engine_wal.db
   âœ… WAL cleanup complete!

ğŸ’¡ Data remains in Redis/MySQL - inspect with:
   â””â”€ Redis:  redis-cli GET user.alice
   â””â”€ MySQL:  SELECT * FROM sync_items;
   â””â”€ UIs:    http://localhost:5540 (RedisInsight)
              http://localhost:8080 (Adminer)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    Example complete!                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•